<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Coin2Cash </title>
    
    <meta
      name="description"
      content="Trade fiat and cryptocurrencies in person"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="index.css" />
    <script type="text/javascript" src="libraries/web3.min.js"></script>

    <script type="text/javascript" src="libraries/jquery.min.js"></script>
    <script type="text/javascript" src="common.js"></script>
  </head>
  <body>

    
    <h1>Coin2Cash
     <br/> <i style="font-size: xx-small; opacity: 0.7; margin-left:0.3%;">The Web App</i></h1>
    <form id="postForm">
      <input
        type="text"
        name="title"
        id="title"
        placeholder="Title for your post"
        maxlength="256"
        required
      />
      <br />
      <input
        type="text"
        name="description"
        id="description"
        placeholder="Description for your post"
        maxlength="256"
        required
      />
      <br />
      <input type="radio" id="seller" value="seller" name="postType" required />
      <label for="seller">Seller</label>
      <input type="radio" id="buyer" value="buyer" name="postType" required />
      <label for="buyer">Buyer</label>
      <br />
      <input type="submit" value="Post" />
    </form>

    <script type="text/javascript">
      var web3js;
      var userAccount;
      var coin2cashContract;
      var coords;
      

    
      function handleSellerPost(title, description) {
        try {
          console.log(title);
          coin2cashContract.methods
          .addSeller(coords.latitude, coords.longitude, description, title, 0)
          .send({ from: userAccount }, (err, res) => {
            console.log(`${err} ${res} here`);
          })
        } catch(e) {
          console.log(e);
          alert("error posting your post");
        }
       
      }


      function handleBuyerPost(title, description) {
        try {
          coin2cashContract.methods
          .addBuyer(97, 12, description, title, 0)
          .send({ from: userAccount }, (err, res) => {
            console.log(`${err} ${res} here`);
          })
        } catch(e) {
          console.log(e);
          alert("error posting your post");
        }
       
      }

      window.addEventListener("load", function () {
        loadWeb3(async () => {
          loadContract(() => {
            getLocation((location) => {
              console.log(location); //doesn't work on http connection requires https
              coords = location.coords;
            });
          });
        });
        document.getElementById("postForm").onsubmit = (e) => {
          e.preventDefault();
          console.log(e);
          var title = document.getElementById("title").value;
          var description = document.getElementById("description").value;
          if (document.getElementById("seller").checked) {
            //seller post
            handleSellerPost(title, description);
          } else {
            //buyer post
            handleBuyerPost(title, description);
          }
        };
      });
    </script>
    <!--[if lt IE 7]>
      <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="#">upgrade your browser</a> to improve your experience.
      </p>
    <![endif]-->

    <script src="" async defer></script>
  </body>
</html>
